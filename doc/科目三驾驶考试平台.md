在一个平行世界中，人类无法进行线下驾驶。已满十八岁的成年人要取得驾照，必须通过在线考试。同时，未来的驾驶活动也将在线上进行...

技术方案：
`Angular + Three.js`
`go + fiber + gorm`
`http(json restful) websocket socket.io`
`docker compose kong`

项目设计文档需要至少包含: 
项目组织以及其中每个文件的说明
```
backend http,websocket
driving socket.io
frontend 
```


前端
- 支持用户注册和登录
- 选择相应的Web3D场景，可以选择模型进入不同房间
- 虚拟化身之间相互可见，并且行为共享
- 可以进行一定方式的交流
- 维护虚拟世界的一致性，同一时刻各个化身能看到的场景应该是一致并且最新的


后端：
- 在使用 `socketio` 进行聊天时，加入异步调用记录函数，将聊天记录添加到数据库中，前端无需等待回调。
- 添加 `websocket` 接入 `Moss` 大模型，接入 `MOSS` AI聊天功能，前端可以通过接口调用 `Moss` 大模型并获得输出，同时在数据库中异步增加记录。
- 使用 `slog` 库为每个请求添加日志记录。
- 对用户密码进行 `md5` 加密，确保在注册和登录时调用加密函数，保障系统安全性。
- 创建 `JWTToken` 进行前端身份校验，通过 `JWTToken` 对接口进行鉴权，确保系统安全性，不仅对HTTP请求进行校验，还对AI聊天接口的WebSocket进行校验。

### 考试过程
- **Three.js**：
	- 碰撞检测
	- 速度控制
- **系统功能**：
    - 用户间交互：模拟汽车鸣笛。
    - 扣分系统检测：环境中设置一些可交互的实体，在特定情况下触发扣分。
- **音视频聊天**：
    - 使用WebRTC支持多模态交互，用户在虚拟世界中可以通过音视频进行交流。
- **文字聊天**：
    - 基于Socket.io实现room、private、global模式的文字聊天。
- **AI聊天**：
    - 接入MOSS，实现AI聊天功能。

### HTTP展示
- **用户后端管理页面**：
    - 提供历史学习行为查看和分析功能。
- **功能细节**：
    - 驾照考试记录：包括分数、开始时间、持续时间、是否有效、是否公开等信息。
    - 考试中的扣分惩罚记录：包括类型、原因、分数和时间。
    - 聊天记录的展示和添加接口。
- **数据库表结构**：
    - 涉及用户、考试、聊天、惩罚等表结构。
- **接口文档**：
    - 使用Swagger生成接口文档，文档说明清晰、详细。

### 服务部署和运维

系统部署分为四个容器，分别是数据库、Socket.io服务、HTTP/WebSocket后端、前端。四个容器通过`docker-compose`进行集成，详细配置请参阅`docker-compose.yaml`文档和各自的Dockerfile文件。

- 基于`docker-compose`在云服务器上部署前后端，使得在任意环境下均可通过云访问，校园网地址为`10.117.245.17:50080`或`10.117.245.17:58080`。
- 公网上通过`https`进行部署，确保安全访问。
- 利用`GitHub Actions`实现CI/CD，代码更新后自动构建并上传到`Docker Hub`。
- 隐私数据如APIKey等存储在服务器的环境变量中，确保安全性

### 技术细节

#### 前端动画场景

本项目利用three.js库，为用户呈现了一个动画的驾车场景。

## 前端代码组织

src/assets目录存放资源文件，包含logo图片、各种模型的资源文件以及font文件

src/app目录存放源代码，接下来进行详细介绍。

我们的前端主要分为两个部分，一个是user模块，用于展示个人信息；另一个是three模块，用于展示3D场景。此外还有一些配件，比如视频聊天、各种工具service等。

user模块主要展示用户基本信息（space）、违规记录（space）、考试记录（exam-record）和聊天记录（chat）。

three模块包含hall界面以及道路界面，前者用于选择车辆、进入房间，后者是主场景。这其中涉及到websocket的应用，相关的service进行统一管理。

## 整体功能介绍

本网站主要用于帮助用户熟悉开车流程以及常见错误。用户在真正使用本网页的功能的时候，需要提前注册和登录。登陆后顶端导航栏会出现以下按钮，分别表示进入开车场景、查看个人信息、查看聊天记录、查看考试记录。

![](./figs/fig01.png)

在Space中用户可以修改个人信息，并可以查看自己的违规记录。

点击Three后，会进入大厅，在这里可以创建房间供学习用，也可以进入别人创建的房间；在页面的另一半可以选择心仪的车辆。

![](./figs/fig02.png)

在进入房间后，系统实时更新房间内车辆信息，保证用户之间的同步。用户之间支持私聊、公聊、视频聊天，还支持和AI进行对话，聊天记录可以在chat页面进行查看。

场景由我们自己编写配置文件搭建起来，设有碰撞箱。（用户之间不会碰撞，以防止互相撞车产生影响）

在开车过程中系统会检测用户开车的违规行为并及时报告，并告诉用户正确的处理方式。在用户退出后，当前学习过程会被记录下来，可在exam-record页面查看。

当用户在一次开车中违规次数较少，他会通过考试，拥有虚拟驾照，下次开车可以选择正式上路。正式上路出现的违规可以在space页面进行查看，在违规次数较多时会被吊销驾照。
